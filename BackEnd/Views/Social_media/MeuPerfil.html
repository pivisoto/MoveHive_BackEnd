<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - Feed Claro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* --- VARIÁVEIS DE COR E ESTILO --- */
        :root {
            --primary-color: #f0f2f5;
            --secondary-color: #ffffff;
            --accent-color: #ffd700;
            --text-color: #333;
            --border-color: #dbdbdb;
            --tiktok-bg: #f0f2f5;
            --tiktok-header-bg: #fff;
            --tiktok-nav-bg: #ffd700;
            --tiktok-nav-active: #e6c300;
            --tiktok-card-bg: #fff;
            --tiktok-card-border: #e0e0e0;
            --tiktok-icon-color: #666;
            --tiktok-accent-text: #333;
            --tiktok-profile-bg: #f8f9fa;
        }

        /* --- ESTILOS GERAIS --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--tiktok-bg); color: var(--text-color); line-height: 1.6; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 600px; background-color: var(--tiktok-bg); position: relative; padding-bottom: 70px; }

        /* --- CABEÇALHO --- */
        .app-header { background-color: var(--tiktok-header-bg); padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--tiktok-card-border); position: sticky; top: 0; z-index: 100; }
        .logo-area { display: flex; align-items: center; }
        .logo-area h1 { font-size: 1.4rem; font-weight: 600; margin-left: 10px; }
        .honeycomb-logo { width: 30px; height: 26px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; }
        .honeycomb-logo div { width: 10px; height: 11.54px; background-color: var(--accent-color); margin: 0.5px; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); }
        .honeycomb-logo div:nth-child(4), .honeycomb-logo div:nth-child(5), .honeycomb-logo div:nth-child(6), .honeycomb-logo div:nth-child(7) { transform: translateX(5px); }
        .header-actions i { font-size: 1.5rem; margin-left: 20px; cursor: pointer; color: var(--tiktok-icon-color); }

        /* --- SEÇÃO DO PERFIL --- */
        .profile-section { background-color: var(--tiktok-profile-bg); padding: 20px 15px 30px 15px; text-align: center; border-bottom: 1px solid var(--tiktok-card-border); }
        .profile-header { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; }
        .profile-picture { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-color); margin-bottom: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .profile-name { font-size: 1.6rem; font-weight: 700; margin-bottom: 5px; }
        .profile-username { font-size: 1rem; color: #777; margin-bottom: 10px; }
        .profile-stats { display: flex; justify-content: space-around; width: 100%; margin-bottom: 20px; }
        .profile-stat-item { display: flex; flex-direction: column; align-items: center; flex: 1; cursor: pointer; }
        .profile-stat-value { font-size: 1.3rem; font-weight: 700; }
        .profile-stat-label { font-size: 0.8rem; color: #777; text-transform: uppercase; }
        .profile-bio { font-size: 0.95rem; color: #444; max-width: 400px; margin: 0 auto 20px auto; }
        .profile-actions { display: flex; justify-content: center; margin-top: 20px; gap: 10px; }
        .profile-button { background-color: var(--accent-color); color: var(--tiktok-accent-text); border: none; padding: 10px 20px; border-radius: 6px; font-size: 0.9rem; font-weight: 600; cursor: pointer; }
        .profile-location { font-size: 0.9rem; color: #888; margin-bottom: 15px; }
        .profile-location i { margin-right: 5px; }

        /* --- ESTILOS PARA SEÇÃO DE PONTOS DESTACADA --- */
        .profile-points-highlight { background: linear-gradient(45deg, var(--accent-color), #ffc107); color: var(--tiktok-accent-text); padding: 12px 20px; border-radius: 12px; display: flex; justify-content: center; align-items: center; gap: 15px; width: 60%; max-width: 250px; margin: 15px auto 25px auto; box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 2px solid #fff; }
        .profile-points-highlight i { font-size: 2.5rem; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .profile-points-highlight div { text-align: left; }
        .profile-points-highlight .profile-stat-value { font-size: 2rem; font-weight: 700; line-height: 1; display: block; }
        .profile-points-highlight .profile-stat-label { font-size: 0.9rem; color: var(--tiktok-accent-text); text-transform: uppercase; font-weight: 600; }

        /* --- ESTILOS PARA SEÇÃO DE ESPORTES --- */
        .profile-sports { text-align: left; max-width: 90%; margin: 0 auto; padding: 20px; background-color: var(--secondary-color); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .profile-sports h4 { font-size: 1.1rem; font-weight: 700; margin-bottom: 20px; text-align: center; color: var(--text-color); }
        .profile-sports-list { list-style: none; padding: 0; display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
        .profile-sports-list li { background-color: var(--primary-color); color: var(--text-color); padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: flex; align-items: center; gap: 8px; border: 1px solid var(--border-color); transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .profile-sports-list li:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .profile-sports-list li i { color: var(--accent-color); font-size: 1rem; }

        /* --- ABAS E CONTEÚDO --- */
        .content-tabs { display: flex; justify-content: space-around; background-color: var(--tiktok-profile-bg); border-bottom: 1px solid var(--tiktok-card-border); position: sticky; top: 60px; z-index: 90; padding: 5px 0; }
        .tab-item { flex-grow: 1; text-align: center; padding: 15px 5px; font-size: 0.9rem; font-weight: 600; color: var(--tiktok-icon-color); cursor: pointer; border-bottom: 3px solid transparent; }
        .tab-item.active { color: var(--text-color); border-bottom-color: var(--accent-color); }
        .tab-item i { margin-right: 5px; font-size: 1rem; }
        .page-content { padding: 0 0 140px 0; }
        .profile-section-container { padding: 20px 15px 0 15px; }
        .content-section { display: none; padding: 20px 15px; }
        .content-section.active { display: block; }
        .empty-message, .error-message, .loading-indicator { text-align: center; color: #888; padding-top: 20px; }

        /* --- ESTILOS DOS CARDS (POST, TREINO, EVENTO) --- */
        .post-card, .treino-card, .evento-card { background-color: var(--tiktok-card-bg); border: 1px solid var(--tiktok-card-border); border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .post-header { display: flex; align-items: center; padding: 10px 15px; }
        .post-profile-pic-small { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 10px; }
        .post-username-small { font-weight: 600; }
        .post-media { width: 100%; max-height: 500px; object-fit: cover; display: block; }
        .post-content { padding: 15px; }
        .post-actions { display: flex; align-items: center; gap: 20px; margin-bottom: 10px; }
        .post-actions span { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; font-weight: 600; }
        .post-actions i { cursor: pointer; font-size: 1.4rem; color: var(--tiktok-icon-color); }
        .post-caption { font-size: 0.9rem; margin-bottom: 10px; }
        .post-caption .username { font-weight: 600; margin-right: 5px; }
        .post-date { font-size: 0.75rem; color: #999; }
        .treino-card, .evento-card { padding: 15px; }
        .treino-header, .evento-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .treino-title, .evento-title { font-size: 1.2rem; font-weight: 600; margin-right: 10px; }
        .treino-sport-badge, .evento-sport-badge { font-size: 0.75rem; font-weight: 500; padding: 3px 8px; border-radius: 12px; background-color: var(--accent-color); color: var(--tiktok-accent-text); display: inline-block; margin-top: 5px; margin-bottom: 10px; }
        .treino-image, .evento-image { width: 100%; max-height: 250px; object-fit: cover; border-radius: 6px; margin-bottom: 15px; border: 1px solid var(--border-color); }
        .treino-details, .evento-details { margin-bottom: 15px; }
        .treino-details p, .evento-details p { font-size: 0.9rem; color: #555; margin-bottom: 6px; display: flex; align-items: center; }
        .treino-details p i, .evento-details p i { margin-right: 8px; width: 16px; text-align: center; color: var(--accent-color); }
        .treino-stats, .evento-stats { display: flex; justify-content: space-around; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); }
        .treino-stats .stat-item, .evento-stats .stat-item { text-align: center; }
        .treino-stats .stat-value, .evento-stats .stat-value { font-size: 1.1rem; font-weight: bold; }
        .treino-stats .stat-label, .evento-stats .stat-label { font-size: 0.7rem; color: #777; text-transform: uppercase; }
        .treino-description, .evento-description, .evento-observations, .evento-prize { font-size: 0.85rem; color: #444; margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--border-color); }
        .evento-observations p, .evento-prize p { margin: 0; }
        .evento-prize p { color: #111; font-weight: 500; }
        .evento-prize i { color: var(--accent-color); }
        .evento-badges { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
        .evento-badge { font-size: 0.7rem; font-weight: 600; padding: 3px 8px; border-radius: 10px; color: #fff; }
        .evento-badge i { margin-right: 4px; }
        .evento-badge.privado { background-color: #c0392b; }
        .evento-badge.torneio { background-color: #2980b9; }

        /* --- NAVEGAÇÃO INFERIOR --- */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: 600px; background-color: var(--tiktok-nav-bg); display: flex; justify-content: space-around; align-items: center; padding: 10px 0; border-top: 1px solid #cca300; z-index: 100; }
        .nav-item { color: var(--tiktok-accent-text); font-size: 1.5rem; text-decoration: none; padding: 5px 15px; }
        .nav-item.active { color: #000; font-weight: bold; }

        /* --- ESTILOS DO MODAL --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background-color: #fff; margin: auto; padding: 20px; border: 1px solid var(--border-color); border-radius: 10px; width: 90%; max-width: 400px; max-height: 80vh; display: flex; flex-direction: column; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 15px; }
        .modal-header h2 { font-size: 1.2rem; margin: 0; }
        .close-button { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-button:hover, .close-button:focus { color: black; }
        .modal-body { overflow-y: auto; }
        .user-list { list-style: none; padding: 0; }
        .user-list-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .user-list-item:last-child { border-bottom: none; }
        .user-list-item img { width: 50px; height: 50px; border-radius: 50%; margin-right: 15px; object-fit: cover; }
        .user-info .user-name { font-weight: 600; font-size: 1rem; }
        .user-info .user-username { font-size: 0.9rem; color: #777; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="logo-area">
                <div class="honeycomb-logo"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
                <h1>Feed Claro</h1>
            </div>
            <div class="header-actions"><i class="fas fa-search"></i><i class="fas fa-bell"></i></div>
        </header>

        <main class="page-content">
            <div class="profile-section-container">
                <section class="profile-section">
                    <div class="profile-header">
                        <img src="" alt="Foto de Perfil" class="profile-picture" id="profile-pic">
                        <h2 class="profile-name" id="profile-name">Carregando...</h2>
                        <p class="profile-username" id="profile-username">@...</p>
                        <p class="profile-location" id="profile-location" style="display: none;"></p>
                        <div class="profile-stats">
                            <div class="profile-stat-item" id="followers-btn">
                                <span class="profile-stat-value" id="profile-followers-count">0</span>
                                <span class="profile-stat-label">Seguidores</span>
                            </div>
                            <div class="profile-stat-item" id="following-btn">
                                <span class="profile-stat-value" id="profile-following-count">0</span>
                                <span class="profile-stat-label">Seguindo</span>
                            </div>
                        </div>
                        
                        <div class="profile-points-highlight">
                            <i class="fas fa-trophy"></i>
                            <div>
                                <span class="profile-stat-value" id="profile-points-count">0</span>
                                <span class="profile-stat-label">Pontos</span>
                            </div>
                        </div>

                        <p class="profile-bio" id="profile-bio">Carregando biografia...</p>
                        
                        <div class="profile-sports" id="profile-sports-section" style="display: none;">
                            <h4>Esportes Praticados</h4>
                            <ul class="profile-sports-list" id="profile-sports-list"></ul>
                        </div>
                        
                        <div class="profile-actions">
                            <a href="http://127.0.0.1:5500/BackEnd/Views/Social_media/EditarPerfil.html" class="profile-button" id="edit-profile-btn">Editar Perfil</a>
                        </div
                    </div>
                </section>
            </div>

            <div class="content-tabs">
                <div class="tab-item active" data-tab="posts"><i class="fas fa-image"></i> Posts</div>
                <div class="tab-item" data-tab="treinos"><i class="fas fa-dumbbell"></i> Treinos</div>
                <div class="tab-item" data-tab="eventos"><i class="fas fa-trophy"></i> Eventos</div>
            </div>

            <div id="posts-content" class="content-section active"><p class="loading-indicator">Carregando posts...</p></div>
            <div id="treinos-content" class="content-section"><p class="loading-indicator">Carregando treinos...</p></div>
            <div id="eventos-content" class="content-section"><p class="loading-indicator">Carregando eventos...</p></div>
        </main>
        
        <nav class="bottom-nav">
            <a href="#" class="nav-item"><i class="fas fa-home"></i></a>
            <a href="#" class="nav-item"><i class="fas fa-dumbbell"></i></a>
            <a href="#" class="nav-item"><i class="fas fa-image"></i></a>
            <a href="#" class="nav-item"><i class="fas fa-trophy"></i></a>
            <a href="#" class="nav-item active"><i class="fas fa-user"></i></a>
        </nav>
    </div>

    <!-- HTML DO MODAL DE SEGUINDO -->
    <div id="following-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Seguindo</h2>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <ul id="following-list" class="user-list"></ul>
            </div>
        </div>
    </div>
    
    <!-- HTML DO MODAL DE SEGUIDORES -->
    <div id="followers-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Seguidores</h2>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <ul id="followers-list" class="user-list"></ul>
            </div>
        </div>
    </div>


<script>
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('jwtToken');
            
            let arePostsLoaded = false;
            let areTreinosLoaded = false;
            let areEventosLoaded = false; 

            // Seletores do Perfil
            const profilePic = document.getElementById('profile-pic');
            const profileName = document.getElementById('profile-name');
            const profileUsername = document.getElementById('profile-username');
            const profileLocation = document.getElementById('profile-location');
            const profileBio = document.getElementById('profile-bio');
            const profileFollowersCount = document.getElementById('profile-followers-count');
            const profileFollowingCount = document.getElementById('profile-following-count');
            const profilePointsCount = document.getElementById('profile-points-count');
            const sportsSection = document.getElementById('profile-sports-section');
            const sportsList = document.getElementById('profile-sports-list');
            
            // Seletores de Conteúdo
            const postsContent = document.getElementById('posts-content');
            const treinosContent = document.getElementById('treinos-content');
            const eventosContent = document.getElementById('eventos-content');

            // --- Seletores para o Modal de "Seguindo" ---
            const followingModal = document.getElementById('following-modal');
            const followingBtn = document.getElementById('following-btn');
            const closeFollowingModalBtn = followingModal.querySelector('.close-button');
            const followingList = document.getElementById('following-list');
            
            // --- Seletores para o Modal de "Seguidores" ---
            const followersModal = document.getElementById('followers-modal');
            const followersBtn = document.getElementById('followers-btn');
            const closeFollowersModalBtn = followersModal.querySelector('.close-button');
            const followersList = document.getElementById('followers-list');

            // --- NOVA FUNÇÃO: Decodifica o token JWT ---
            function decodeJwt(token) {
                try {
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    return JSON.parse(jsonPayload);
                } catch (e) {
                    console.error("Erro ao decodificar o token:", e);
                    return null;
                }
            }

            async function loadUserData() {
                if (!token) {
                    profileName.textContent = "Acesso Negado";
                    return;
                }

                // --- LÓGICA MODIFICADA: Define o endpoint com base no tipo de usuário ---
                const decodedToken = decodeJwt(token);
                const userType = decodedToken ? decodedToken.tipo_usuario : null;

                let apiEndpoint = 'http://127.0.0.1:5000/usuario/MeuPerfil'; // Padrão
                if (userType === 'empresa') {
                    apiEndpoint = 'http://127.0.0.1:5000/usuarioEmpresa/MeuPerfil'; // Endpoint para Empresa
                }
                // Fim da lógica modificada

                try {
                    const response = await fetch(apiEndpoint, { headers: { 'Authorization': `Bearer ${token}` } });
                    if (!response.ok) throw new Error('Falha ao carregar perfil.');
                    const userData = await response.json();
                    
                    console.log(`--- API Call: ${apiEndpoint} ---`);
                    console.log("Dados Retornados:", userData);
                    
                    // Passa o tipo de usuário para a função de preenchimento
                    populateProfileData(userData, userType); 
                    
                    // Carrega os posts (assumindo que o endpoint de posts é o mesmo para ambos)
                    await loadPosts(userData);
                    arePostsLoaded = true;

                } catch (error) {
                    console.error("Erro no loadUserData:", error);
                    profileName.textContent = "Erro ao carregar perfil";
                }
            }

            // --- FUNÇÃO MODIFICADA: Aceita 'userType' para ajustar a UI ---
            function populateProfileData(userData, userType) {
                profilePic.src = userData.foto_perfil || '';
                profileName.textContent = userData.nome_completo || 'Nome não definido';
                profileUsername.textContent = `@${userData.username || 'username'}`;
                profileBio.textContent = userData.biografia || 'Nenhuma biografia informada.';
                profileFollowersCount.textContent = userData.seguidores_count !== undefined ? userData.seguidores_count : '0';
                profileFollowingCount.textContent = userData.seguindo_count !== undefined ? userData.seguindo_count : '0';
                
                if (userData.cidade && userData.estado) {
                    profileLocation.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${userData.cidade}, ${userData.estado}`;
                    profileLocation.style.display = 'block';
                }

                // --- Lógica de UI baseada no tipo de usuário ---
                if (userType === 'empresa') {
                    // Esconde seções que não se aplicam à empresa
                    document.querySelector('.profile-points-highlight').style.display = 'none';
                    document.getElementById('profile-sports-section').style.display = 'none';
                    document.querySelector('.tab-item[data-tab="treinos"]').style.display = 'none';

                    // Usa os totais pré-calculados da API para empresa
                    const postsCount = userData.total_posts || 0;
                    const eventosCount = userData.total_eventos || 0;
                    
                    document.querySelector('.tab-item[data-tab="posts"]').innerHTML = `<i class="fas fa-image"></i> Posts (${postsCount})`;
                    document.querySelector('.tab-item[data-tab="eventos"]').innerHTML = `<i class="fas fa-trophy"></i> Eventos (${eventosCount})`;

                } else {
                    // Lógica original para usuário padrão
                    profilePointsCount.textContent = userData.pontos ? Math.round(userData.pontos) : '0';

                    const postsCount = userData.post_criados ? userData.post_criados.length : 0;
                    const treinosCount = userData.treinos_id ? userData.treinos_id.length : 0;
                    const eventosCount = (userData.eventos_criados ? userData.eventos_criados.length : 0) + (userData.eventos_participando ? userData.eventos_participando.length : 0);

                    document.querySelector('.tab-item[data-tab="posts"]').innerHTML = `<i class="fas fa-image"></i> Posts (${postsCount})`;
                    document.querySelector('.tab-item[data-tab="treinos"]').innerHTML = `<i class="fas fa-dumbbell"></i> Treinos (${treinosCount})`;
                    document.querySelector('.tab-item[data-tab="eventos"]').innerHTML = `<i class="fas fa-trophy"></i> Eventos (${eventosCount})`;
                    
                    const sportIcons = {
                        'futebol': 'fas fa-futbol', 'basquete': 'fas fa-basketball-ball', 'volei': 'fas fa-volleyball-ball',
                        'tenis': 'fas fa-table-tennis', 'corrida': 'fas fa-running', 'natacao': 'fas fa-swimmer',
                        'ciclismo': 'fas fa-biking', 'musculacao': 'fas fa-dumbbell', 'yoga': 'fas fa-praying-hands', 'default': 'fas fa-medal'
                    };

                    const sports = userData.esportes_praticados;
                    sportsList.innerHTML = '';
                    if (sports && typeof sports === 'object' && Object.keys(sports).length > 0) {
                        sportsSection.style.display = 'block';
                        for (const sport in sports) {
                            const level = sports[sport];
                            const sportKey = sport.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                            const iconClass = sportIcons[sportKey] || sportIcons['default'];
                            const listItem = document.createElement('li');
                            listItem.innerHTML = `<i class="${iconClass}"></i> <span>${sport.charAt(0).toUpperCase() + sport.slice(1)} (${level.charAt(0).toUpperCase() + level.slice(1)})</span>`;
                            sportsList.appendChild(listItem);
                        }
                    }
                }
            }
            
            // O restante do seu código JavaScript permanece o mesmo
            // (loadPosts, loadTreinos, loadEventos, modais, etc...)

            async function loadPosts(authorData) {
                postsContent.innerHTML = '<p class="loading-indicator">Carregando posts...</p>';
                try {
                    // Este endpoint pode precisar ser ajustado se empresas tiverem uma rota diferente
                    const apiEndpoint = 'http://127.0.0.1:5000/postagem/ListarPostagens';
                    const response = await fetch(apiEndpoint, { headers: { 'Authorization': `Bearer ${token}` } });
                    if (!response.ok) throw new Error('Falha ao carregar postagens.');
                    const posts = await response.json();
                    
                    console.log("--- API Call: /postagem/ListarPostagens ---");
                    console.log("Dados Retornados:", posts);

                    postsContent.innerHTML = ''; 
                    if (posts.length === 0) {
                        postsContent.innerHTML = '<p class="empty-message">Nenhum post encontrado.</p>';
                        return;
                    }
                    posts.forEach(post => postsContent.appendChild(createPostCard(post, authorData)));
                } catch (error) {
                    console.error("Erro no loadPosts:", error);
                    postsContent.innerHTML = '<p class="error-message">Erro ao carregar os posts.</p>';
                }
            }
            
            async function loadTreinos() {
                treinosContent.innerHTML = '<p class="loading-indicator">Carregando treinos...</p>';
                try {
                    const apiEndpoint = 'http://127.0.0.1:5000/treino/ListarTreino';
                    const response = await fetch(apiEndpoint, { headers: { 'Authorization': `Bearer ${token}` } });
                    if (!response.ok) throw new Error('Falha ao carregar treinos.');
                    const treinos = await response.json();
                    
                    console.log("--- API Call: /treino/ListarTreino ---");
                    console.log("Dados Retornados:", treinos);

                    treinosContent.innerHTML = ''; 
                    if (treinos.length === 0) {
                        treinosContent.innerHTML = '<p class="empty-message">Nenhum treino encontrado.</p>';
                        return;
                    }
                    treinos.sort((a, b) => new Date(b.data_hora) - new Date(a.data_hora));
                    treinos.forEach(treino => treinosContent.appendChild(createTreinoCard(treino)));
                } catch (error) {
                    console.error("Erro no loadTreinos:", error);
                    treinosContent.innerHTML = '<p class="error-message">Erro ao carregar os treinos.</p>';
                }
            }
            
            async function loadEventos() {
                eventosContent.innerHTML = '<p class="loading-indicator">Carregando eventos...</p>';
                try {
                    const apiEndpoint = 'http://127.0.0.1:5000/evento/meusEventos';
                    const response = await fetch(apiEndpoint, { headers: { 'Authorization': `Bearer ${token}` } });
                    if (!response.ok) throw new Error('Falha ao carregar eventos.');
                    const eventos = await response.json();

                    console.log("--- API Call: /evento/meusEventos ---");
                    console.log("Dados Retornados:", eventos);
                    
                    eventosContent.innerHTML = ''; 
                    if (eventos.length === 0) {
                        eventosContent.innerHTML = '<p class="empty-message">Nenhum evento encontrado.</p>';
                        return;
                    }
                    eventos.sort((a, b) => new Date(b.data_hora) - new Date(a.data_hora));
                    eventos.forEach(evento => eventosContent.appendChild(createEventoCard(evento)));
                } catch (error) {
                    console.error("Erro no loadEventos:", error);
                    eventosContent.innerHTML = '<p class="error-message">Erro ao carregar os eventos.</p>';
                }
            }

            async function showFollowersModal() {
                followersList.innerHTML = '<p class="loading-indicator">Carregando...</p>';
                followersModal.style.display = 'flex';

                try {
                    // Este endpoint pode precisar ser ajustado se empresas tiverem uma rota diferente
                    const apiEndpoint = 'http://127.0.0.1:5000/usuario/usuariosSeguidores';
                    const response = await fetch(apiEndpoint, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (!response.ok) throw new Error('Falha ao carregar a lista de seguidores.');
                    
                    const data = await response.json();
                    
                    console.log("--- API Call: /usuario/usuariosSeguidores ---");
                    console.log("Dados Retornados:", data);

                    const users = data.seguidores;
                    followersList.innerHTML = ''; 

                    if (users && users.length > 0) {
                        users.forEach(user => {
                            const listItem = document.createElement('li');
                            listItem.className = 'user-list-item';
                            listItem.innerHTML = `
                                <img src="${user.foto_perfil || ''}" alt="Foto de ${user.nome_completo}">
                                <div class="user-info">
                                    <div class="user-name">${user.nome_completo}</div>
                                    <div class="user-username">@${user.username}</div>
                                </div>`;
                            followersList.appendChild(listItem);
                        });
                    } else {
                        followersList.innerHTML = '<p class="empty-message">Ninguém está te seguindo ainda.</p>';
                    }
                } catch (error) {
                    console.error("Erro no showFollowersModal:", error);
                    followersList.innerHTML = '<p class="error-message">Erro ao carregar a lista de seguidores.</p>';
                }
            }

            async function showFollowingModal() {
                followingList.innerHTML = '<p class="loading-indicator">Carregando...</p>';
                followingModal.style.display = 'flex'; 

                try {
                     // Este endpoint pode precisar ser ajustado se empresas tiverem uma rota diferente
                    const apiEndpoint = 'http://127.0.0.1:5000/usuario/usuariosSeguidos';
                    const response = await fetch(apiEndpoint, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (!response.ok) throw new Error('Falha ao carregar a lista de usuários seguidos.');
                    
                    const data = await response.json();
                    
                    console.log("--- API Call: /usuario/usuariosSeguidos ---");
                    console.log("Dados Retornados:", data);
                    
                    const users = data.usuarios_seguindo;
                    followingList.innerHTML = ''; 

                    if (users && users.length > 0) {
                        users.forEach(user => {
                            const listItem = document.createElement('li');
                            listItem.className = 'user-list-item';
                            listItem.innerHTML = `
                                <img src="${user.foto_perfil || ''}" alt="Foto de ${user.nome_completo}">
                                <div class="user-info">
                                    <div class="user-name">${user.nome_completo}</div>
                                    <div class="user-username">@${user.username}</div>
                                </div>`;
                            followingList.appendChild(listItem);
                        });
                    } else {
                        followingList.innerHTML = '<p class="empty-message">Você não está seguindo ninguém ainda.</p>';
                    }
                } catch (error) {
                    console.error("Erro no showFollowingModal:", error);
                    followingList.innerHTML = '<p class="error-message">Erro ao carregar a lista.</p>';
                }
            }
            
            function createPostCard(postData, authorData) {
                const card = document.createElement('article');
                card.className = 'post-card';
                card.innerHTML = `
                    <div class="post-header">
                        <img src="${authorData.foto_perfil || ''}" alt="Foto de ${authorData.nome_completo}" class="post-profile-pic-small">
                        <span class="post-username-small">${authorData.nome_completo}</span>
                    </div>
                    ${postData.imagem ? `<img src="${postData.imagem}" alt="Mídia do post" class="post-media">` : ''}
                    <div class="post-content">
                        <div class="post-actions">
                            <span><i class="far fa-heart"></i> ${postData.contador_curtidas || 0}</span>
                            <span><i class="far fa-comment"></i> ${postData.comentarios ? postData.comentarios.length : 0}</span>
                        </div>
                        <div class="post-caption"><span class="username">${authorData.username}</span> <span>${postData.descricao || ''}</span></div>
                        <div class="post-date">${formatDateTime(postData.data_criacao, { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                    </div>`;
                return card;
            }

            function createTreinoCard(treinoData) {
                const card = document.createElement('article');
                card.className = 'treino-card';
                const esporteNome = (treinoData.esporte && treinoData.esporte.nome) ? treinoData.esporte.nome : 'Esporte';
                const dataFormatada = formatDateTime(treinoData.data_hora);
                const pontosFormatados = treinoData.pontos ? Math.round(treinoData.pontos) : '0';
                const tempoFormatado = treinoData.tempo_treinado ? `${treinoData.tempo_treinado} min` : '-';
                card.innerHTML = `
                    <div class="treino-header">
                        <div>
                            <h3 class="treino-title">${treinoData.titulo || 'Treino sem título'}</h3>
                            <span class="treino-sport-badge">${esporteNome}</span>
                        </div>
                    </div>
                    ${treinoData.arquivo_imagem ? `<img src="${treinoData.arquivo_imagem}" alt="Imagem do treino" class="treino-image">` : ''}
                    <div class="treino-details">
                        <p><i class="fas fa-calendar-alt"></i> ${dataFormatada}</p>
                        <p><i class="fas fa-map-marker-alt"></i> ${treinoData.lugar || 'Local não informado'}</p>
                    </div>
                    <div class="treino-stats">
                        <div class="stat-item"><span class="stat-value">${pontosFormatados}</span><span class="stat-label">Pontos</span></div>
                        <div class="stat-item"><span class="stat-value">${tempoFormatado}</span><span class="stat-label">Duração</span></div>
                    </div>
                    ${treinoData.descricao ? `<div class="treino-description">${treinoData.descricao}</div>` : ''}`;
                return card;
            }
            
            function createEventoCard(eventoData) {
                const card = document.createElement('article');
                card.className = 'evento-card';
                const titulo = eventoData.titulo || 'Evento sem título';
                const esporteNome = eventoData.esporte_nome || 'Multiesportivo';
                const imagemSrc = eventoData.foto;
                const dataFormatada = formatDateTime(eventoData.data_hora);
                const localizacao = eventoData.localizacao || 'Local a definir';
                const numParticipantes = eventoData.participantes ? eventoData.participantes.length : 0;
                const maxParticipantes = eventoData.max_participantes || 'Ilimitado';
                const isPrivado = eventoData.privado;
                const isTorneio = eventoData.torneio;
                const premiacao = eventoData.premiacao;
                const imagemHtml = imagemSrc ? `<img src="${imagemSrc}" alt="Imagem do evento" class="evento-image">` : '';
                const privadoHtml = isPrivado ? `<span class="evento-badge privado"><i class="fas fa-lock"></i> Privado</span>` : '';
                const torneioHtml = isTorneio ? `<span class="evento-badge torneio"><i class="fas fa-trophy"></i> Torneio</span>` : '';
                const premiacaoHtml = isTorneio && premiacao ? `<div class="evento-prize"><p><i class="fas fa-gift"></i> <strong>Premiação:</strong> ${premiacao}</p></div>` : '';
                const descricaoHtml = eventoData.descricao ? `<div class="evento-description">${eventoData.descricao}</div>` : '';
                const observacoesHtml = eventoData.observacoes ? `<div class="evento-observations"><p><strong>Observações:</strong> ${eventoData.observacoes}</p></div>` : '';
                card.innerHTML = `
                    <div class="evento-header">
                        <div>
                            <h3 class="evento-title">${titulo}</h3>
                            <span class="evento-sport-badge">${esporteNome}</span>
                        </div>
                        <div class="evento-badges">${privadoHtml}${torneioHtml}</div>
                    </div>
                    ${imagemHtml}
                    <div class="evento-details">
                        <p><i class="fas fa-calendar-alt"></i> ${dataFormatada}</p>
                        <p><i class="fas fa-map-marker-alt"></i> ${localizacao}</p>
                    </div>
                    <div class="evento-stats">
                        <div class="stat-item"><span class="stat-value">${numParticipantes} / ${maxParticipantes}</span><span class="stat-label">Participantes</span></div>
                    </div>
                    ${premiacaoHtml}${descricaoHtml}${observacoesHtml}`;
                return card;
            }

            function formatDateTime(isoString, options = {}) {
                if (!isoString) return '';
                const defaultOptions = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' };
                const finalOptions = { ...defaultOptions, ...options };
                const date = new Date(isoString);
                date.setMinutes(date.getMinutes() + date.getTimezoneOffset());
                return date.toLocaleDateString('pt-BR', finalOptions).replace(',', ' às');
            }

            const tabItems = document.querySelectorAll('.tab-item');
            const contentSections = document.querySelectorAll('.content-section');
            tabItems.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    if (tabName === 'treinos' && !areTreinosLoaded) { loadTreinos(); areTreinosLoaded = true; } 
                    else if (tabName === 'eventos' && !areEventosLoaded) { loadEventos(); areEventosLoaded = true; }
                    tabItems.forEach(t => t.classList.remove('active'));
                    contentSections.forEach(s => s.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tabName}-content`).classList.add('active');
                });
            });
            
            // Event Listeners para os Modais
            followingBtn.addEventListener('click', showFollowingModal);
            closeFollowingModalBtn.addEventListener('click', () => { followingModal.style.display = 'none'; });
            
            followersBtn.addEventListener('click', showFollowersModal);
            closeFollowersModalBtn.addEventListener('click', () => { followersModal.style.display = 'none'; });
            
            window.addEventListener('click', (event) => {
                if (event.target == followingModal) { followingModal.style.display = 'none'; }
                if (event.target == followersModal) { followersModal.style.display = 'none'; }
            });

            loadUserData();
        });
    </script>
</body>
</html>