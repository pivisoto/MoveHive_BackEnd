<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Perfil - Feed Claro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* --- ESTILOS VISUAIS (sem alterações) --- */
        :root {
            --primary-color: #f0f2f5;
            --secondary-color: #ffffff;
            --accent-color: #ffd700;
            --text-color: #333;
            --border-color: #dbdbdb;
            --tiktok-bg: #f0f2f5;
            --tiktok-header-bg: #fff;
            --tiktok-card-bg: #fff;
            --tiktok-card-border: #e0e0e0;
            --tiktok-icon-color: #666;
            --tiktok-accent-text: #333;
            --error-color: #c0392b;
            --delete-color: #e74c3c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tiktok-bg);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            justify-content: center;
        }

        .app-container { width: 100%; max-width: 600px; background-color: var(--secondary-color); position: relative; }
        .app-header { background-color: var(--tiktok-header-bg); padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--tiktok-card-border); position: sticky; top: 0; z-index: 100; }
        .app-header h2 { font-size: 1.2rem; font-weight: 600; }
        .header-action { font-size: 1.5rem; color: var(--tiktok-icon-color); text-decoration: none; }
        .header-save-btn { background: none; border: none; color: var(--accent-color); font-size: 1rem; font-weight: 700; cursor: pointer; }
        .page-content { padding: 20px 15px 80px 15px; }
        .profile-picture-editor { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; }
        .picture-wrapper { position: relative; cursor: pointer; }
        .profile-picture-preview { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-color); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        .picture-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 2rem; opacity: 0; transition: opacity 0.2s ease; }
        .picture-wrapper:hover .picture-overlay { opacity: 1; }
        .change-photo-text { font-weight: 600; color: var(--text-color); margin-top: 10px; }
        #foto_perfil_input { display: none; }
        .edit-profile-form .form-group { margin-bottom: 20px; }
        .edit-profile-form label { display: block; font-size: 0.9rem; font-weight: 600; color: #555; margin-bottom: 8px; }
        .edit-profile-form input[type="text"], .edit-profile-form input[type="email"], .edit-profile-form input[type="password"], .edit-profile-form input[type="date"], .edit-profile-form textarea, .edit-profile-form select { width: 100%; padding: 12px 15px; font-size: 1rem; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--primary-color); color: var(--text-color); transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .edit-profile-form input::placeholder, .edit-profile-form textarea::placeholder { color: #999; }
        .edit-profile-form input:focus, .edit-profile-form textarea:focus, .edit-profile-form select:focus { outline: none; border-color: var(--accent-color); background-color: var(--secondary-color); box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.25); }
        .edit-profile-form textarea { min-height: 100px; resize: vertical; }
        .form-row { display: flex; gap: 15px; }
        .form-row .form-group { flex: 1; }
        .password-section { margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .password-note { font-size: 0.85rem; color: #777; margin-bottom: 15px; }
        .action-button { display: block; width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-top: 15px; transition: background-color 0.2s ease; }
        .save-button { background-color: var(--accent-color); color: var(--tiktok-accent-text); }
        .save-button:hover { background-color: #e6c300; }
        .save-button:disabled { background-color: #ccc; cursor: not-allowed; }
        .delete-button { background-color: transparent; color: var(--delete-color); border: 1px solid var(--delete-color); }
        .delete-button:hover { background-color: var(--delete-color); color: white; }
        .form-error-message { color: var(--error-color); font-size: 0.85rem; margin-top: 5px; display: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content { background-color: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); text-align: center; max-width: 90%; width: 400px; transform: scale(0.9); transition: transform 0.3s ease; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-content h3 { margin-bottom: 15px; font-size: 1.4rem; }
        .modal-content p { margin-bottom: 25px; color: #666; }
        .modal-actions { display: flex; justify-content: center; gap: 15px; }
        .modal-btn { padding: 10px 20px; border-radius: 8px; border: none; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
        .modal-btn-confirm { background-color: var(--delete-color); color: white; }
        .modal-btn-confirm:hover { background-color: #c0392b; }
        .modal-btn-confirm:disabled { background-color: #ccc; cursor: not-allowed; }
        .modal-btn-cancel { background-color: #f0f2f5; color: #333; }
        .modal-btn-cancel:hover { background-color: #e1e3e6; }
        
        /* --- ESTILOS DA SEÇÃO DE ESPORTES (sem alterações) --- */
        .sports-manager { margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); }
        #sports-list { margin-bottom: 20px; }
        .sport-item { display: flex; justify-content: space-between; align-items: center; background-color: var(--primary-color); padding: 10px 15px; border-radius: 8px; margin-bottom: 8px; }
        .sport-item span { font-weight: 500; }
        .sport-item .level { color: #777; font-size: 0.9rem; margin-left: 10px; text-transform: capitalize; }
        .sport-item button { background: none; border: none; color: var(--delete-color); cursor: pointer; font-size: 1.2rem; padding: 5px; line-height: 1; }
        .add-sport-controls { display: flex; gap: 10px; align-items: stretch; }
        .add-sport-controls select { flex: 1; } /* MODIFICADO para aplicar ao select */
        .add-sport-btn { padding: 0 18px; background-color: var(--tiktok-icon-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; }
        .add-sport-btn:hover { background-color: #555; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <a href="http://127.0.0.1:5500/BackEnd/Views/Social_media/MeuPerfil.html" class="header-action"><i class="fas fa-arrow-left"></i></a>
            <h2>Editar Perfil</h2>
            <button class="header-save-btn" id="header-save-btn">Salvar</button>
        </header>

        <main class="page-content">
            <form id="edit-profile-form" class="edit-profile-form">
                <!-- Seção de Foto, Nome, etc. (sem alterações) -->
                <div class="profile-picture-editor">
                    <label for="foto_perfil_input" class="picture-wrapper">
                        <img src="" alt="Foto de Perfil" class="profile-picture-preview" id="profile-pic-preview">
                        <div class="picture-overlay"><i class="fas fa-camera"></i></div>
                    </label>
                    <input type="file" id="foto_perfil_input" name="foto_perfil" accept="image/*">
                    <span class="change-photo-text">Alterar foto de perfil</span>
                </div>
                <div class="form-group"><label for="nome_completo">Nome Completo</label><input type="text" id="nome_completo" name="nome_completo" placeholder="Carregando..."></div>
                <div class="form-group"><label for="username">Nome de Usuário</label><input type="text" id="username" name="username" placeholder="Carregando..."></div>
                <div class="form-group"><label for="biografia">Biografia</label><textarea id="biografia" name="biografia" placeholder="Carregando..."></textarea></div>
                <div class="form-group"><label for="email">E-mail</label><input type="email" id="email" name="email" placeholder="Carregando..."></div>
                <div class="form-row"><div class="form-group"><label for="estado">Estado</label><select id="estado" name="estado"><option value="">Carregando estados...</option></select></div><div class="form-group"><label for="cidade">Cidade</label><select id="cidade" name="cidade" disabled><option value="">Selecione um estado primeiro</option></select></div></div>
                <div class="form-group"><label for="data_nascimento">Data de Nascimento</label><input type="date" id="data_nascimento" name="data_nascimento"></div>
                
                <!-- ======================================================= -->
                <!--    SEÇÃO DE GERENCIAMENTO DE ESPORTES (MODIFICADA)      -->
                <!-- ======================================================= -->
                <div class="sports-manager">
                    <label style="margin-bottom: 15px;">Esportes Praticados</label>
                    <div id="sports-list">
                        <!-- A lista de esportes será inserida aqui pelo JavaScript -->
                    </div>
                    <div class="add-sport-controls">
                        <!-- MODIFICADO: Trocado o input de texto por um select -->
                        <select id="new-sport-name-select">
                            <option value="">Carregando esportes...</option>
                        </select>
                        <select id="new-sport-level-select">
                            <option value="Amador">Amador</option>
                            <option value="Iniciante">Iniciante</option>
                            <option value="profissional">Profissional</option>
                        </select>
                        <button type="button" id="add-sport-btn" class="add-sport-btn"><i class="fas fa-plus"></i></button>
                    </div>
                </div>

                <!-- Seção de Senha e Botões (sem alterações) -->
                <div class="password-section">
                    <p class="password-note">Deixe os campos abaixo em branco se não desejar alterar sua senha.</p>
                    <div class="form-group"><label for="senha">Nova Senha</label><input type="password" id="senha" name="senha" placeholder="••••••••"></div>
                    <div class="form-group"><label for="confirmar_senha">Confirmar Nova Senha</label><input type="password" id="confirmar_senha" name="confirmar_senha" placeholder="••••••••"><p id="password-match-error" class="form-error-message">As senhas não coincidem.</p></div>
                </div>
                <button type="submit" class="action-button save-button" id="main-save-btn">Salvar Alterações</button>
                <button type="button" class="action-button delete-button" id="delete-account-btn">Excluir Conta</button>
            </form>
        </main>
    </div>

    <!-- POP-UP DE CONFIRMAÇÃO DE EXCLUSÃO (sem alterações) -->
    <div class="modal-overlay" id="delete-confirm-modal"><div class="modal-content"><h3>Confirmar Exclusão</h3><p>Você tem certeza que deseja excluir sua conta? Esta ação é permanente e todos os seus dados serão removidos.</p><div class="modal-actions"><button class="modal-btn modal-btn-cancel" id="cancel-delete-btn">Cancelar</button><button class="modal-btn modal-btn-confirm" id="confirm-delete-btn">Sim, excluir</button></div></div></div>

    <!-- ======================================================= -->
    <!--           SCRIPT COM DEBUG ADICIONADO                 -->
    <!-- ======================================================= -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // --- CONFIGURAÇÕES E SELETORES ---
            const token = localStorage.getItem('jwtToken');
            const API_BASE_URL = 'http://127.0.0.1:5000';
            const API_SPORTS_URL = `${API_BASE_URL}/esportes/ListarEsportes`;
            const IBGE_API_URL = 'https://servicodados.ibge.gov.br/api/v1/localidades';

            // Seletores existentes...
            const form = document.getElementById('edit-profile-form');
            const profilePicPreview = document.getElementById('profile-pic-preview');
            const fileInput = document.getElementById('foto_perfil_input');
            const nomeCompletoInput = document.getElementById('nome_completo');
            const usernameInput = document.getElementById('username');
            const biografiaInput = document.getElementById('biografia');
            const emailInput = document.getElementById('email');
            const estadoSelect = document.getElementById('estado');
            const cidadeSelect = document.getElementById('cidade');
            const dataNascimentoInput = document.getElementById('data_nascimento');
            const senhaInput = document.getElementById('senha');
            const confirmarSenhaInput = document.getElementById('confirmar_senha');
            const passwordErrorMsg = document.getElementById('password-match-error');
            const mainSaveBtn = document.getElementById('main-save-btn');
            const headerSaveBtn = document.getElementById('header-save-btn');
            const deleteAccountBtn = document.getElementById('delete-account-btn');
            const deleteConfirmModal = document.getElementById('delete-confirm-modal');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            
            // --- SELETORES PARA ESPORTES ---
            const sportsListContainer = document.getElementById('sports-list');
            const newSportNameSelect = document.getElementById('new-sport-name-select');
            const newSportLevelSelect = document.getElementById('new-sport-level-select');
            const addSportBtn = document.getElementById('add-sport-btn');
            
            let userSports = {};

            // --- FUNÇÕES DE API ---
            
            async function loadSports() {
                console.log("--- [API Call] Iniciando busca de esportes ---");
                console.log(`Endpoint: GET ${API_SPORTS_URL}`);
                try {
                    const response = await fetch(API_SPORTS_URL);
                    
                    if (!response.ok) {
                        console.error(`[API Response] Falha ao buscar esportes. Status: ${response.status}`);
                        throw new Error('Falha ao buscar esportes.');
                    }
                    
                    const sports = await response.json();
                    console.log("[API Response] Esportes recebidos com sucesso:", sports);

                    newSportNameSelect.innerHTML = '<option value="">Selecione um esporte</option>';
                    sports.sort((a, b) => a.nome.localeCompare(b.nome));
                    
                    sports.forEach(sport => {
                        const option = document.createElement('option');
                        option.value = sport.nome;
                        option.textContent = sport.nome;
                        newSportNameSelect.appendChild(option);
                    });
                } catch (error) {
                    console.error("[API Error] Erro detalhado ao buscar esportes:", error);
                    newSportNameSelect.innerHTML = '<option value="">Erro ao carregar</option>';
                }
            }
            
            async function loadStates() { 
                console.log("--- [IBGE API Call] Buscando estados ---");
                try {
                    const response = await fetch(`${IBGE_API_URL}/estados`);
                    if (!response.ok) throw new Error('Falha ao buscar estados.');
                    const states = await response.json();
                    console.log("[IBGE Response] Estados recebidos:", states.length);
                    estadoSelect.innerHTML = '<option value="">Selecione um estado</option>';
                    states.sort((a, b) => a.nome.localeCompare(b.nome));
                    states.forEach(state => {
                        const option = document.createElement('option');
                        option.value = state.sigla;
                        option.textContent = state.nome;
                        estadoSelect.appendChild(option);
                    });
                } catch (error) {
                    console.error("[IBGE Error] Erro ao buscar estados:", error);
                    estadoSelect.innerHTML = '<option value="">Erro ao carregar</option>';
                }
            }
            
            async function loadCities(stateSigla) { 
                if (!stateSigla) {
                    cidadeSelect.innerHTML = '<option value="">Selecione um estado primeiro</option>';
                    cidadeSelect.disabled = true;
                    return;
                }
                console.log(`--- [IBGE API Call] Buscando cidades para o estado: ${stateSigla} ---`);
                cidadeSelect.innerHTML = '<option value="">Carregando cidades...</option>';
                cidadeSelect.disabled = true;
                try {
                    const response = await fetch(`${IBGE_API_URL}/estados/${stateSigla}/municipios`);
                    if (!response.ok) throw new Error('Falha ao buscar cidades.');
                    const cities = await response.json();
                    console.log(`[IBGE Response] Cidades recebidas para ${stateSigla}:`, cities.length);
                    cidadeSelect.innerHTML = '<option value="">Selecione uma cidade</option>';
                    cities.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city.nome;
                        option.textContent = city.nome;
                        cidadeSelect.appendChild(option);
                    });
                    cidadeSelect.disabled = false;
                } catch (error) {
                    console.error("[IBGE Error] Erro ao buscar cidades:", error);
                    cidadeSelect.innerHTML = '<option value="">Erro ao carregar</option>';
                }
            }

            // --- FUNÇÕES DE DADOS DO USUÁRIO ---
            async function loadUserProfile() { 
                console.log("--- [API Call] Iniciando busca de perfil do usuário ---");
                if (!token) {
                    console.error("[Auth Error] Token JWT não encontrado no localStorage.");
                    alert('Erro de autenticação: Token não encontrado.');
                    window.location.href = '/login.html';
                    return;
                }
                
                const headers = { 'Authorization': `Bearer ${token}` };
                console.log(`Endpoint: GET ${API_BASE_URL}/usuario/MeuPerfil`);
                console.log("Cabeçalhos enviados:", headers);

                try {
                    const response = await fetch(`${API_BASE_URL}/usuario/MeuPerfil`, {
                        method: 'GET',
                        headers: headers
                    });
                    
                    const userData = await response.json();

                    if (!response.ok) {
                        console.error(`[API Response] Falha ao carregar perfil. Status: ${response.status}`, userData);
                        throw new Error(userData.erro || `Erro: ${response.statusText}`);
                    }
                    
                    console.log("[API Response] Dados do perfil recebidos com sucesso:", userData);
                    await populateForm(userData);

                } catch (error) {
                    console.error('[API Error] Erro detalhado ao carregar perfil:', error);
                    alert('Não foi possível carregar seus dados.');
                }
            }

            async function populateForm(data) {
                console.log("Preenchendo o formulário com os dados recebidos.");
                profilePicPreview.src = data.foto_perfil || '';
                nomeCompletoInput.value = data.nome_completo || '';
                usernameInput.value = data.username || '';
                biografiaInput.value = data.biografia || '';
                emailInput.value = data.email || '';

                if (data.data_nascimento) {
                    const birthDate = new Date(data.data_nascimento);
                    const year = birthDate.getUTCFullYear();
                    const month = String(birthDate.getUTCMonth() + 1).padStart(2, '0');
                    const day = String(birthDate.getUTCDate()).padStart(2, '0');
                    dataNascimentoInput.value = `${year}-${month}-${day}`;
                } else {
                    dataNascimentoInput.value = '';
                }

                if (data.estado) {
                    estadoSelect.value = data.estado;
                    await loadCities(data.estado);
                    if (data.cidade) {
                        cidadeSelect.value = data.cidade;
                    }
                }
                
                if (data.esportes_praticados && typeof data.esportes_praticados === 'object') {
                    userSports = data.esportes_praticados;
                } else {
                    userSports = {};
                }
                renderSportsList();
            }
            
            // --- FUNÇÕES PARA GERENCIAR ESPORTES NA INTERFACE ---
            function renderSportsList() {
                sportsListContainer.innerHTML = '';
                if (Object.keys(userSports).length === 0) {
                    sportsListContainer.innerHTML = '<p style="color: #888; text-align: center; margin-bottom: 15px;">Nenhum esporte adicionado.</p>';
                    return;
                }
                for (const sportName in userSports) {
                    const level = userSports[sportName];
                    const sportItem = document.createElement('div');
                    sportItem.className = 'sport-item';
                    sportItem.innerHTML = `<div><span>${sportName}</span><span class="level">(${level})</span></div><button type="button" class="remove-sport-btn" data-sport="${sportName}" title="Remover esporte">&times;</button>`;
                    sportsListContainer.appendChild(sportItem);
                }
                document.querySelectorAll('.remove-sport-btn').forEach(button => {
                    button.addEventListener('click', handleRemoveSport);
                });
            }

            function handleAddSport() {
                const name = newSportNameSelect.value;
                const level = newSportLevelSelect.value;
                
                if (name === '') {
                    alert('Por favor, selecione um esporte da lista.');
                    return;
                }
                
                userSports[name] = level;
                console.log("Esporte adicionado localmente:", { [name]: level });
                console.log("Estado atual dos esportes:", userSports);
                
                newSportNameSelect.value = '';
                renderSportsList();
            }

            function handleRemoveSport(event) {
                const sportNameToRemove = event.currentTarget.dataset.sport;
                if (sportNameToRemove && userSports.hasOwnProperty(sportNameToRemove)) {
                    delete userSports[sportNameToRemove];
                    console.log(`Esporte removido localmente: ${sportNameToRemove}`);
                    console.log("Estado atual dos esportes:", userSports);
                    renderSportsList();
                }
            }

            // --- FUNÇÃO DE ENVIO ---
            async function handleFormSubmit(event) {
                event.preventDefault();
                console.log("--- [API Call] Iniciando envio de atualização de perfil ---");

                if (!token) { console.error("[Auth Error] Token não encontrado."); alert('Erro de autenticação: Token não encontrado.'); return; }
                if (senhaInput.value !== confirmarSenhaInput.value) { alert('As senhas não coincidem. Por favor, verifique.'); return; }
                
                setButtonsLoading(true);

                const formData = new FormData();
                formData.append('nome_completo', nomeCompletoInput.value);
                formData.append('username', usernameInput.value);
                formData.append('biografia', biografiaInput.value);
                formData.append('email', emailInput.value);
                formData.append('estado', estadoSelect.value);
                formData.append('cidade', cidadeSelect.value);
                formData.append('data_nascimento', dataNascimentoInput.value);
                formData.append('esportes_praticados', JSON.stringify(userSports));

                if (senhaInput.value) { formData.append('senha', senhaInput.value); }
                if (fileInput.files[0]) { formData.append('foto_perfil', fileInput.files[0]); }
                
                // Log para ver os dados que estão sendo enviados
                console.log(`Endpoint: PUT ${API_BASE_URL}/usuario/EditarUsuario`);
                console.log("Dados (FormData) a serem enviados:");
                for (let [key, value] of formData.entries()) {
                    if (value instanceof File) {
                        console.log(`  ${key}:`, value); // Mostra o objeto do arquivo
                    } else {
                        console.log(`  ${key}: ${value}`);
                    }
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/usuario/EditarUsuario`, {
                        method: 'PUT',
                        headers: { 'Authorization': `Bearer ${token}` },
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (!response.ok) {
                        console.error(`[API Response] Erro ao salvar. Status: ${response.status}`, result);
                        throw new Error(result.erro || 'Ocorreu um erro ao salvar.');
                    }

                    console.log("[API Response] Perfil atualizado com sucesso:", result);
                    alert(result.mensagem || 'Perfil atualizado com sucesso!');

                } catch (error) {
                    console.error('[API Error] Falha detalhada ao salvar o perfil:', error);
                    alert(`Erro: ${error.message}`);
                } finally {
                    setButtonsLoading(false);
                }
            }

            // --- FUNÇÕES AUXILIARES, LISTENERS E INICIALIZAÇÃO ---
            async function handleDeleteAccount() { /* ... (função sem alterações) ... */ }
            function validatePasswordsOnInput() { /* ... (função sem alterações) ... */ }
            function setButtonsLoading(isLoading) { /* ... (função sem alterações) ... */ }

            function setupEventListeners() {
                form.addEventListener('submit', handleFormSubmit);
                headerSaveBtn.addEventListener('click', () => form.requestSubmit());
                fileInput.addEventListener('change', () => {
                    if (fileInput.files && fileInput.files[0]) {
                        const reader = new FileReader();
                        reader.onload = (e) => { profilePicPreview.src = e.target.result; };
                        reader.readAsDataURL(fileInput.files[0]);
                    }
                });
                estadoSelect.addEventListener('change', () => loadCities(estadoSelect.value));
                senhaInput.addEventListener('input', validatePasswordsOnInput);
                confirmarSenhaInput.addEventListener('input', validatePasswordsOnInput);
                addSportBtn.addEventListener('click', handleAddSport);
                deleteAccountBtn.addEventListener('click', () => deleteConfirmModal.classList.add('show'));
                cancelDeleteBtn.addEventListener('click', () => deleteConfirmModal.classList.remove('show'));
                confirmDeleteBtn.addEventListener('click', handleDeleteAccount);
            }

            // --- INICIALIZAÇÃO ---
            console.log("Iniciando script da página de edição de perfil...");
            setupEventListeners();
            
            await Promise.all([
                loadStates(),
                loadSports()
            ]);

            await loadUserProfile();
            console.log("Página completamente carregada e pronta.");
        });
    </script>
</body>
</html>